<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25" zv="Cache for UNIX (SUSE Linux Enterprise Server for x86-64) 2017.2.1 (Build 801)" ts="2018-01-04 09:38:33">
<Class name="%DeepSee.UI.DSButtonsViewer">
<Description>
DeepSee DeepSeeButtons Viewer.
Display contents of the DeepSeeButtons html file for the current namespace.
</Description>
<Super>%DeepSee.UI.standardPage</Super>
<System>4</System>
<TimeChanged>64651,60799.69251</TimeChanged>
<TimeCreated>64636,45154.455633</TimeCreated>

<Parameter name="PAGENAME">
<Default>DeepSeeButtons Viewer</Default>
</Parameter>

<Parameter name="DOCBOOKID">
<Default>D2MODEL_cube_build_errors</Default>
</Parameter>

<Property name="targetURL">
<Type>%String</Type>
<Parameter name="MAXLEN"/>
</Property>

<XData name="Style">
<Data><![CDATA[
<style type="text/css">

body {
	background: rgb(240,240,240);
}

.ribbonTitle {
	color: rgb(71,72,67);
	background: rgb(140,221,174);
}

#sourceFrame {
	border: 1px solid #808080;
	background: white;
	overflow: auto;
	margin-left: 20px;
}

#sourceFrame pre {
	color: #404040;
	padding: 3px;
}

.footerlinks {
	font-family: Arial, Helvetica, sans-serif;
	font-size: 10px;
	font-style: bold;
	color: #3b84bc;
	padding-left:4px;
}
</style>
]]></Data>
</XData>

<XData name="contentPane">
<Description>
This XML defines the contents of the contents pane for this page.</Description>
<XMLNamespace>http://www.intersystems.com/zen</XMLNamespace>
<Data><![CDATA[
<pane xmlns="http://www.intersystems.com/zen" 
	xmlns:deepsee="http://www.intersystems.com/deepsee"
>
<!--
<html id="sourceFrame" OnDrawContent="DrawLogFile"/>
src="DeepSeeButtons_ISC_20180103_1402.html"
-->
<iframe id="sourceFrame" width="100%" height="100%"
src="DeepSeeButtons_ISC_20180103_1402.html"
    />
</pane>
]]></Data>
</XData>

<UDLText name="T">
<Content><![CDATA[
/*
/// Draw contents of log file pane.
Method DrawLogFile(pSeed As %String) As %Status
{
	Set tSC = $$$OK
	Try {
		Set tFileName = ##class(%DeepSee.Utils).%GetLogFileName()

		If ('##class(%File).Exists(tFileName)) {
			&html<<pre>>
			Write $$$Text("Log file does not exist: "),!
			Write tFileName,!
			&html<</pre>>
			Quit
		}
		&html<<a href="#bottom" name="top" class="footerlinks">#($$$TextHTML("[Goto Bottom]"))#</a>>
		&html<<pre>>
		Write tFileName,!
		Write $ZDT($ZU(188),3),!			// DTB332 - Use $ZU function which accounts for local time
		Write "-----------------------",!

		Set tFile = ##class(%File).%New(tFileName)
		Set tSC = tFile.Open("RS")
		If $$$ISERR(tSC) Quit
		While ('tFile.AtEnd) {
			Write $ZCVT(tFile.ReadLine(),"O","HTML"),!
		}

		Write "###",!
		&html<</pre>>
		&html<<a href="#top" name="bottom" class="footerlinks">#($$$TextHTML("[Goto Top]"))#</a>>
	}
	Catch(ex) {
		Set tSC = ex.AsStatus()
	}

	Quit tSC
}*/
]]></Content>
</UDLText>

<Method name="%OnGetTitle">
<Description>
Get the (localized) title string for the page.</Description>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Quit $$$Text("DeepSeeButtons Viewer")
]]></Implementation>
</Method>

<Method name="%OnGetPageName">
<Description>
Get the name for the page.</Description>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Quit $$$Text("DeepSeeButtons Viewer")
]]></Implementation>
</Method>

<Method name="%OnGetProductName">
<Description>
Get the product name for the page.</Description>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Quit "DeepSee"
]]></Implementation>
</Method>

<Method name="OnGetRibbonInfo">
<Description>
Get information to display in the ribbon bar.</Description>
<FormalSpec>*pDisplay:%Boolean,*pViewIcons:%List,*pSortOptions:%List,*pSearchBox:%Boolean,*pRibbonTitle:%String,*pCommands:%List</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set pDisplay = 1
	Set pSearchBox = 0
	Set pRibbonTitle = $$$Text("DeepSeeButtons Viewer")

	// commands
	// $LB(id,caption,help,onclick)
	Set pCommands(1) = $LB("cmdRefresh",$$$Text("Refresh"),$$$Text("Reload contents of DeepSeeButtons file"),"zenPage.refreshLog();")
	Set pCommands(2) = $LB("cmdDelete",$$$Text("Delete"),$$$Text("Delete DeepSeeButtons file"),"zenPage.deleteLog();")
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="onPopupAction">
<Description>
This client event is fired when the a popup page launched from this page fires an action.</Description>
<FormalSpec>popupName,action,value</FormalSpec>
<Language>javascript</Language>
<ClientMethod>1</ClientMethod>
<Implementation><![CDATA[
	switch(popupName) {
	case 'switchNamespace':
		var homeurl = zenLink("/csp/sys/%25CSP.Portal.Home.zen");
		var url = zenPage.GetNewURL(value,"_DeepSee.UI.DSButtonsViewer.zen");
		if (url == "" || value == "%SYS") url = homeurl;
		self.document.location = url;
		break;
	}
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
/*
/// Ale: I took this from %CSP.Portal.CourceControl.Dialog.Manager
/// Code to resize the iframe based on the window size and check whether a title 
ClientMethod initializeFrame(newSrc) [ Language = javascript ]
{
	var sourceFrame = zen('sourceFrame');
	var iframe = sourceFrame.findElement('iframe');
	// iframe.contentDocument doesn't work as expected on IE8, so use more circuitous reference.
	if (iframe && iframe.contentWindow && iframe.contentWindow.document && (iframe.contentWindow.document.title != null)) {
		document.title = iframe.contentWindow.document.title;
	}
	else if (!this._titleTimer) {
		this._titleTimer = setInterval('zenPage.updateTitle()',10);
	}
	if (newSrc) this.addCompletionCheck('zenPage.checkCompletion()',10);
	
	var width = zenGetWindowWidth();
	var height = zenGetWindowHeight();
	if (zenIsHTML5 && (zenIsIE || zenIsGecko)) {
		width -= 4;
		height -= 4;
	}
	else if (zenIsIE) {
		height -= 1;
	}
	
	sourceFrame.setProperty('width',width);
	sourceFrame.setProperty('height',height);
}
*/
]]></Content>
</UDLText>

<Method name="onlayoutHandler">
<Description>
Adjust sizes of components on the page.</Description>
<FormalSpec>load</FormalSpec>
<Language>javascript</Language>
<ClientMethod>1</ClientMethod>
<Implementation><![CDATA[
	try {
		//this.initializeFrame(load);
		this.adjustSizes();
	}
	catch(ex) {
		zenExceptionHandler(ex,arguments,'Error in onlayoutHandler');
	}
]]></Implementation>
</Method>

<Method name="adjustSizes">
<Description>
Adjust sizes of components on the page.</Description>
<Language>javascript</Language>
<ClientMethod>1</ClientMethod>
<Implementation><![CDATA[
	try {
		var sourceFrame = zen('sourceFrame');
		var divLog = sourceFrame.getEnclosingDiv();

		// find size of window
		var winHeight = zenGetWindowHeight();
		var winWidth = zenGetWindowWidth();
		var th = this.getTitleAreaHeight();
		var h = winHeight - (25 + th);

		if (divLog) {
			divLog.style.width = winWidth - (25) + 'px';
			divLog.style.height = h + 'px';
		}
	}
	catch(ex) {
		zenExceptionHandler(ex,arguments,'Error in adjustSizes');
	}
]]></Implementation>
</Method>

<Method name="%GetDeepSeeButtonsFileName">
<Internal>1</Internal>
<ClassMethod>1</ClassMethod>
<FormalSpec>pFileName:%String="DeepSeeTasks"</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Quit ##class(%Library.File).NormalizeFilename($system.Util.ManagerDirectory() _ pFileName _ "_" _ $ZU(5) _ ".log")
]]></Implementation>
</Method>

<Method name="%OnAfterCreatePage">
<Description>
This class method callback is called just before the server-side page 
object is created.</Description>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set tSC = $$$OK
	Try {
 		/*Set tSourceFrame = ..%GetComponentById("sourceFrame")
 		Set ..targetURL = "DeepSeeButtons_ISC_20180103_1402.html"
 		Set tFileName = ..%GetDeepSeeButtonsFileName()
 		
 		Set tSourceFrame.src = ..targetURL
 		*/
		Set tSC = ##super()
		If $$$ISERR(tSC) Quit
	}
	Catch(ex) {
		Set tSC = ex.AsStatus()
	}
	Quit tSC
]]></Implementation>
</Method>

<Method name="refreshLog">
<Description>
Reload contents of file.</Description>
<Language>javascript</Language>
<ClientMethod>1</ClientMethod>
<Implementation><![CDATA[	zen('sourceFrame').refreshContents();
]]></Implementation>
</Method>

<Method name="deleteLog">
<Description>
Delete the log file.</Description>
<Language>javascript</Language>
<ClientMethod>1</ClientMethod>
<Implementation><![CDATA[
	if (confirm($$$Text('Do you wish to delete the DeepSeeButtons file?'))) {
		alert("Here I should create something like %DeepSee.Utils).%KillLogFile")
		var msg = zenPage.DeleteLogFile();
		if ('' !== msg) {
			alert(msg);
		}
		zen('sourceFrame').refreshContents();
	}
]]></Implementation>
</Method>

<Method name="DeleteLogFile">
<Description>
Delete the log file.</Description>
<ReturnType>%String</ReturnType>
<ZenMethod>1</ZenMethod>
<Implementation><![CDATA[
	Set tSC = $$$OK
	Set tMsg = ""
	Try {
		//Set tSC = ##class(%DeepSee.Utils).%KillLogFile()
		//ALE
		If $$$ISERR(tSC) Quit
	}
	Catch(ex) {
		Set tSC = ex.AsStatus()
	}
	If $$$ISERR(tSC) {
		Set tMsg = $System.Status.GetOneErrorText(tSC)
	}
	Quit tMsg
]]></Implementation>
</Method>
</Class>
</Export>
